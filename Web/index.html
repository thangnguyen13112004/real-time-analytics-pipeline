<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Store - Global Electronics</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>üõí Tech Store Global</h1>
            <p>Fraud Detection Demo System</p>
        </div>
    </header>

    <div class="container">
        <!-- Customer Selection Panel -->
        <div class="customer-panel">
            <h2>üë§ Ch·ªçn Kh√°ch H√†ng (Gi·∫£ l·∫≠p ƒëƒÉng nh·∫≠p)</h2>
            <div class="customer-selector">
                <label for="customerSelect">Kh√°ch h√†ng hi·ªán t·∫°i:</label>
                <select id="customerSelect" onchange="updateCustomerInfo()">
                    <option value="">-- Ch·ªçn kh√°ch h√†ng --</option>
                </select>
            </div>
            <div class="customer-info" id="customerInfo">
                <p>üìç <strong>V·ªã tr√≠:</strong> <span id="customerLocation">Ch∆∞a ch·ªçn</span></p>
                <p>üÜî <strong>Customer ID:</strong> <span id="customerIdDisplay">N/A</span></p>
            </div>
        </div>

        <!-- Stats Panel -->
        <div class="stats-panel">
            <div class="stat-card">
                <h3>T·ªïng giao d·ªãch</h3>
                <p id="totalTransactions">0</p>
            </div>
            <div class="stat-card">
                <h3>Th√†nh c√¥ng</h3>
                <p id="successTransactions" style="color: #28a745;">0</p>
            </div>
            <div class="stat-card">
                <h3>Th·∫•t b·∫°i</h3>
                <p id="failedTransactions" style="color: #dc3545;">0</p>
            </div>
            <div class="stat-card">
                <h3>Doanh thu</h3>
                <p id="totalRevenue">$0</p>
            </div>
        </div>

        <!-- Products Grid -->
        <div class="products-section">
            <h2>üõçÔ∏è S·∫£n Ph·∫©m</h2>
            <div class="products-grid" id="productsGrid"></div>
        </div>

        <!-- Transaction Log -->
        <div class="transactions-section">
            <h2>üìä L·ªãch S·ª≠ Giao D·ªãch</h2>
            <div class="transaction-log" id="transactionLog"></div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
        // C·∫•u h√¨nh API
        const API_URL = 'http://localhost:5000';

        // D·ªØ li·ªáu s·∫£n ph·∫©m chi ti·∫øt - m·ªói th∆∞∆°ng hi·ªáu l√† m·ªôt s·∫£n ph·∫©m
        const products = [
            // Laptops
            { id: 'product1', name: 'Laptop', category: 'electronics', brand: 'Apple', priceRange: [800, 1000], currency: 'USD', paymentMethod: 'credit_card' },
            { id: 'product2', name: 'Laptop', category: 'electronics', brand: 'Samsung', priceRange: [600, 900], currency: 'USD', paymentMethod: 'debit_card' },
            { id: 'product3', name: 'Laptop', category: 'electronics', brand: 'Sony', priceRange: [700, 950], currency: 'GBP', paymentMethod: 'online_transfer' },
            
            // Mobiles
            { id: 'product4', name: 'Mobile', category: 'electronics', brand: 'Apple', priceRange: [700, 1000], currency: 'USD', paymentMethod: 'credit_card' },
            { id: 'product5', name: 'Mobile', category: 'electronics', brand: 'Samsung', priceRange: [400, 800], currency: 'GBP', paymentMethod: 'debit_card' },
            { id: 'product6', name: 'Mobile', category: 'electronics', brand: 'OnePlus', priceRange: [300, 600], currency: 'USD', paymentMethod: 'online_transfer' },
            { id: 'product7', name: 'Mobile', category: 'electronics', brand: 'Mi', priceRange: [200, 500], currency: 'USD', paymentMethod: 'debit_card' },
            
            // Tablets
            { id: 'product8', name: 'Tablet', category: 'electronics', brand: 'Apple', priceRange: [500, 900], currency: 'USD', paymentMethod: 'credit_card' },
            { id: 'product9', name: 'Tablet', category: 'electronics', brand: 'Samsung', priceRange: [300, 700], currency: 'GBP', paymentMethod: 'online_transfer' },
            { id: 'product10', name: 'Tablet', category: 'electronics', brand: 'Mi', priceRange: [250, 500], currency: 'USD', paymentMethod: 'debit_card' },
            
            // Watches
            { id: 'product11', name: 'Watch', category: 'fashion', brand: 'Apple', priceRange: [400, 800], currency: 'USD', paymentMethod: 'credit_card' },
            { id: 'product12', name: 'Watch', category: 'fashion', brand: 'Samsung', priceRange: [200, 600], currency: 'GBP', paymentMethod: 'debit_card' },
            { id: 'product13', name: 'Watch', category: 'fashion', brand: 'Mi', priceRange: [100, 400], currency: 'USD', paymentMethod: 'online_transfer' },
            
            // Headphones
            { id: 'product14', name: 'Headphone', category: 'electronics', brand: 'Apple', priceRange: [200, 500], currency: 'USD', paymentMethod: 'credit_card' },
            { id: 'product15', name: 'Headphone', category: 'electronics', brand: 'Sony', priceRange: [150, 450], currency: 'GBP', paymentMethod: 'debit_card' },
            { id: 'product16', name: 'Headphone', category: 'electronics', brand: 'Boat', priceRange: [50, 300], currency: 'USD', paymentMethod: 'online_transfer' },
            
            // Speakers
            { id: 'product17', name: 'Speaker', category: 'home', brand: 'Samsung', priceRange: [150, 600], currency: 'USD', paymentMethod: 'credit_card' },
            { id: 'product18', name: 'Speaker', category: 'home', brand: 'Sony', priceRange: [120, 550], currency: 'GBP', paymentMethod: 'debit_card' },
            { id: 'product19', name: 'Speaker', category: 'home', brand: 'Boat', priceRange: [80, 400], currency: 'USD', paymentMethod: 'online_transfer' },
            
            // Cameras
            { id: 'product20', name: 'Camera', category: 'electronics', brand: 'Sony', priceRange: [500, 1200], currency: 'USD', paymentMethod: 'credit_card' },
            { id: 'product21', name: 'Camera', category: 'electronics', brand: 'Samsung', priceRange: [400, 1000], currency: 'GBP', paymentMethod: 'debit_card' },
            
            // Clothing
            { id: 'product22', name: 'T-Shirt', category: 'fashion', brand: 'Nike', priceRange: [20, 80], currency: 'USD', paymentMethod: 'credit_card' },
            { id: 'product23', name: 'Jeans', category: 'fashion', brand: 'Levi\'s', priceRange: [50, 150], currency: 'USD', paymentMethod: 'debit_card' },
            { id: 'product24', name: 'Sneakers', category: 'fashion', brand: 'Adidas', priceRange: [60, 200], currency: 'GBP', paymentMethod: 'online_transfer' },
            
            // Grocery
            { id: 'product25', name: 'Coffee', category: 'grocery', brand: 'Starbucks', priceRange: [10, 50], currency: 'USD', paymentMethod: 'debit_card' },
            { id: 'product26', name: 'Snacks Pack', category: 'grocery', brand: 'Lay\'s', priceRange: [5, 30], currency: 'USD', paymentMethod: 'online_transfer' },
            
            // Beauty
            { id: 'product27', name: 'Perfume', category: 'beauty', brand: 'Dior', priceRange: [80, 300], currency: 'GBP', paymentMethod: 'credit_card' },
            { id: 'product28', name: 'Lipstick', category: 'beauty', brand: 'MAC', priceRange: [20, 60], currency: 'USD', paymentMethod: 'debit_card' },
            { id: 'product29', name: 'Face Cream', category: 'beauty', brand: 'L\'Oreal', priceRange: [15, 80], currency: 'USD', paymentMethod: 'online_transfer' },
            
            // Sports
            { id: 'product30', name: 'Yoga Mat', category: 'sports', brand: 'Nike', priceRange: [20, 80], currency: 'USD', paymentMethod: 'debit_card' },
            { id: 'product31', name: 'Dumbbells', category: 'sports', brand: 'Adidas', priceRange: [30, 150], currency: 'GBP', paymentMethod: 'credit_card' },
            { id: 'product32', name: 'Running Shoes', category: 'sports', brand: 'Puma', priceRange: [50, 180], currency: 'USD', paymentMethod: 'online_transfer' }
        ];

        // D·ªØ li·ªáu kh√°ch h√†ng theo qu·ªëc gia
        const customersByCountry = {
            'USA': {
                customers: ['john_smith', 'sarah_johnson', 'michael_brown', 'emily_davis', 'david_wilson'],
                flag: 'üá∫üá∏',
                location: 'United States'
            },
            'UK': {
                customers: ['john_smith', 'olivia_anderson', 'william_thomas', 'sophie_jackson', 'harry_white'],
                flag: 'üá¨üáß',
                location: 'United Kingdom'
            },
            'Vietnam': {
                customers: ['john_smith', 'tran_thi_b', 'le_van_c', 'pham_thi_d', 'hoang_van_e'],
                flag: 'üáªüá≥',
                location: 'Vietnam'
            },
            'Japan': {
                customers: ['john_smith', 'sato_akira', 'suzuki_hana', 'yamamoto_kenji', 'watanabe_mei'],
                flag: 'üáØüáµ',
                location: 'Japan'
            },
            'Germany': {
                customers: ['john_smith', 'schmidt_anna', 'weber_klaus', 'wagner_lisa', 'becker_tom'],
                flag: 'üá©üá™',
                location: 'Germany'
            },
            'France': {
                customers: ['john_smith', 'martin_marie', 'bernard_jean', 'petit_sophie', 'robert_luc'],
                flag: 'üá´üá∑',
                location: 'France'
            },
            'Australia': {
                customers: ['john_smith', 'brown_emma', 'wilson_oliver', 'taylor_mia', 'anderson_noah'],
                flag: 'üá¶üá∫',
                location: 'Australia'
            },
            'Canada': {
                customers: ['john_smith', 'gagnon_marie', 'tremblay_luc', 'cote_emma', 'bouchard_alex'],
                flag: 'üá®üá¶',
                location: 'Canada'
            }
        };

        let currentCustomer = null;
        let currentCountry = null;
        let transactions = [];
        let totalRevenue = 0;
        let successCount = 0;
        let failedCount = 0;

        // Kh·ªüi t·∫°o customer selector
        function initializeCustomerSelector() {
            const select = document.getElementById('customerSelect');
            
            Object.keys(customersByCountry).forEach(country => {
                const countryData = customersByCountry[country];
                countryData.customers.forEach(customer => {
                    const option = document.createElement('option');
                    option.value = JSON.stringify({ customer, country });
                    option.textContent = `${countryData.flag} ${customer} (${country})`;
                    select.appendChild(option);
                });
            });
        }

        function updateCustomerInfo() {
            const select = document.getElementById('customerSelect');
            if (select.value) {
                const data = JSON.parse(select.value);
                currentCustomer = data.customer;
                currentCountry = data.country;
                
                const countryData = customersByCountry[currentCountry];
                document.getElementById('customerLocation').textContent = 
                    `${countryData.flag} ${countryData.location}`;
                document.getElementById('customerIdDisplay').textContent = currentCustomer;
            } else {
                currentCustomer = null;
                currentCountry = null;
                document.getElementById('customerLocation').textContent = 'Ch∆∞a ch·ªçn';
                document.getElementById('customerIdDisplay').textContent = 'N/A';
            }
        }

        // H√†m utility
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        function randomFloat(min, max, decimals = 2) {
            return parseFloat((Math.random() * (max - min) + min).toFixed(decimals));
        }

        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function getProductIcon(name) {
            const icons = {
                'Laptop': 'üíª',
                'Mobile': 'üì±',
                'Tablet': 'üì±',
                'Watch': '‚åö',
                'Headphone': 'üéß',
                'Speaker': 'üîä',
                'Camera': 'üì∑',
                'T-Shirt': 'üëï',
                'Jeans': 'üëñ',
                'Sneakers': 'üëü',
                'Coffee': '‚òï',
                'Snacks Pack': 'üçø',
                'Perfume': 'üíê',
                'Lipstick': 'üíÑ',
                'Face Cream': 'üß¥',
                'Yoga Mat': 'üßò',
                'Dumbbells': 'üèãÔ∏è',
                'Running Shoes': 'üëü'
            };
            return icons[name] || 'üì¶';
        }

        function getCategoryIcon(category) {
            const icons = {
                'electronics': '‚ö°',
                'fashion': 'üëó',
                'home': 'üè†',
                'grocery': 'üõí',
                'beauty': 'üíÖ',
                'sports': '‚öΩ'
            };
            return icons[category] || 'üì¶';
        }

        function formatPaymentMethod(method) {
            const methods = {
                'credit_card': 'Th·∫ª t√≠n d·ª•ng',
                'debit_card': 'Th·∫ª ghi n·ª£',
                'online_transfer': 'Chuy·ªÉn kho·∫£n'
            };
            return methods[method] || method;
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.className = 'toast';
            }, 3000);
        }

        // Hi·ªÉn th·ªã s·∫£n ph·∫©m
        function displayProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = products.map(product => {
                const samplePrice = randomFloat(product.priceRange[0], product.priceRange[1]);
                
                return `
                    <div class="product-card">
                        <div class="product-icon">${getProductIcon(product.name)}</div>
                        <h3>${product.name}</h3>
                        <p class="brand"><strong>H√£ng:</strong> ${product.brand}</p>
                        <p class="price"><strong>Gi√°:</strong> ${samplePrice} ${product.currency}</p>
                        <p class="category">${getCategoryIcon(product.category)} <strong>Danh m·ª•c:</strong> ${product.category}</p>
                        <p class="payment"><strong>Thanh to√°n:</strong> ${formatPaymentMethod(product.paymentMethod)}</p>
                        <p class="currency"><strong>Ti·ªÅn t·ªá:</strong> ${product.currency}</p>
                        <div class="product-location">
                            <span class="location-icon">üìç</span>
                            <span id="product-location-${product.id}">Ch·ªçn kh√°ch h√†ng ƒë·ªÉ xem v·ªã tr√≠</span>
                        </div>
                        <button class="buy-btn" onclick="purchaseProduct('${product.id}')">
                            <span class="btn-icon">üõí</span> Mua ngay
                        </button>
                    </div>
                `;
            }).join('');
            
            updateProductLocations();
        }

        function updateProductLocations() {
            products.forEach(product => {
                const locationEl = document.getElementById(`product-location-${product.id}`);
                if (currentCustomer && currentCountry) {
                    const countryData = customersByCountry[currentCountry];
                    locationEl.textContent = `${countryData.flag} ${countryData.location}`;
                    locationEl.style.color = '#28a745';
                    locationEl.style.fontWeight = 'bold';
                } else {
                    locationEl.textContent = 'Ch·ªçn kh√°ch h√†ng ƒë·ªÉ xem v·ªã tr√≠';
                    locationEl.style.color = '#999';
                    locationEl.style.fontWeight = 'normal';
                }
            });
        }

        // T·∫°o giao d·ªãch
        function generateTransaction(product) {
            const price = randomFloat(product.priceRange[0], product.priceRange[1]);
            const quantity = randomInt(1, 10);

            const transaction = {
                transactionId: generateUUID(),
                productId: product.id,
                productName: product.name,
                productCategory: product.category,
                productPrice: price,
                productQuantity: quantity,
                productBrand: product.brand,
                currency: product.currency,
                customerId: currentCustomer,
                customerCountry: currentCountry,
                transactionDate: new Date().toISOString(),
                paymentMethod: product.paymentMethod,
                totalAmount: parseFloat((price * quantity).toFixed(2))
            };

            return transaction;
        }

        // X·ª≠ l√Ω mua h√†ng
        async function purchaseProduct(productId) {
            if (!currentCustomer) {
                showToast('‚ö†Ô∏è Vui l√≤ng ch·ªçn kh√°ch h√†ng tr∆∞·ªõc khi mua h√†ng!', 'error');
                return;
            }

            const product = products.find(p => p.id === productId);
            const transaction = generateTransaction(product);
            
            // Hi·ªÉn th·ªã loading
            showToast('‚è≥ ƒêang x·ª≠ l√Ω giao d·ªãch...', 'info');
            
            try {
                // G·ª≠i t·ªõi Flask API
                const response = await fetch(`${API_URL}/transaction`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(transaction)
                });

                const result = await response.json();

                if (response.ok && result.status === 'success') {
                    // Th√†nh c√¥ng
                    transactions.unshift(transaction);
                    totalRevenue += transaction.totalAmount;
                    successCount++;
                    
                    updateStats();
                    addTransactionToLog(transaction, 'success');
                    showToast('‚úÖ Giao d·ªãch th√†nh c√¥ng! ƒê√£ g·ª≠i l√™n Kafka', 'success');
                } else {
                    // Th·∫•t b·∫°i
                    failedCount++;
                    updateStats();
                    addTransactionToLog(transaction, 'failed');
                    showToast(`‚ùå Giao d·ªãch th·∫•t b·∫°i: ${result.message}`, 'error');
                }
            } catch (error) {
                // L·ªói k·∫øt n·ªëi
                failedCount++;
                updateStats();
                addTransactionToLog(transaction, 'failed');
                showToast(`‚ùå L·ªói k·∫øt n·ªëi: ${error.message}`, 'error');
                console.error('Error:', error);
            }
        }

        function updateStats() {
            document.getElementById('totalTransactions').textContent = successCount + failedCount;
            document.getElementById('successTransactions').textContent = successCount;
            document.getElementById('failedTransactions').textContent = failedCount;
            document.getElementById('totalRevenue').textContent = `$${totalRevenue.toFixed(2)}`;
        }

        function addTransactionToLog(transaction, status) {
            const log = document.getElementById('transactionLog');
            const transactionElement = document.createElement('div');
            transactionElement.className = `transaction-item ${status}`;
            
            const statusIcon = status === 'success' ? '‚úÖ' : '‚ùå';
            const statusText = status === 'success' ? 'Th√†nh c√¥ng' : 'Th·∫•t b·∫°i';
            const countryData = customersByCountry[transaction.customerCountry];
            
            transactionElement.innerHTML = `
                <div class="transaction-header">
                    <span class="transaction-id">üîñ ${transaction.transactionId.substring(0, 8)}...</span>
                    <span class="transaction-status ${status}">${statusIcon} ${statusText}</span>
                    <span class="transaction-date">${new Date(transaction.transactionDate).toLocaleString('vi-VN')}</span>
                </div>
                <div class="transaction-details">
                    <div class="detail-row">
                        <span><strong>S·∫£n ph·∫©m:</strong> ${transaction.productName} (${transaction.productBrand})</span>
                        <span><strong>Danh m·ª•c:</strong> ${getCategoryIcon(transaction.productCategory)} ${transaction.productCategory}</span>
                    </div>
                    <div class="detail-row">
                        <span><strong>Kh√°ch h√†ng:</strong> ${transaction.customerId}</span>
                        <span><strong>V·ªã tr√≠:</strong> ${countryData.flag} ${countryData.location}</span>
                    </div>
                    <div class="detail-row">
                        <span><strong>S·ªë l∆∞·ª£ng:</strong> ${transaction.productQuantity}</span>
                        <span><strong>ƒê∆°n gi√°:</strong> ${transaction.productPrice} ${transaction.currency}</span>
                    </div>
                    <div class="detail-row">
                        <span><strong>Thanh to√°n:</strong> ${formatPaymentMethod(transaction.paymentMethod)}</span>
                        <span class="total-amount"><strong>T·ªïng ti·ªÅn:</strong> ${transaction.totalAmount} ${transaction.currency}</span>
                    </div>
                </div>
            `;
            
            log.insertBefore(transactionElement, log.firstChild);
            
            // Gi·ªõi h·∫°n 20 giao d·ªãch hi·ªÉn th·ªã
            while (log.children.length > 20) {
                log.removeChild(log.lastChild);
            }
        }

        // L·∫Øng nghe thay ƒë·ªïi customer ƒë·ªÉ c·∫≠p nh·∫≠t v·ªã tr√≠ tr√™n s·∫£n ph·∫©m
        document.getElementById('customerSelect').addEventListener('change', updateProductLocations);

        // Kh·ªüi t·∫°o
        initializeCustomerSelector();
        displayProducts();
    </script>
</body>
</html>